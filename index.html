<!DOCTYPE html>
<html>
<head>
    <title>ブックラック強度シミュレーター</title>
    <style>
        body { margin: 0; }
        canvas { display: block; }
        #info { position: absolute; top: 10px; width: 100%; text-align: center; color: white; }
    </style>
</head>
<body>
    <div id="info">STLファイルをドラッグ＆ドロップしてください</div>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { STLLoader } from 'three/addons/loaders/STLLoader.js';

        // 1. シーン・カメラ・レンダラーの準備
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // 2. STL読み込みと「強度色」の適用関数
        const loader = new STLLoader();
        function loadModel(url) {
            loader.load(url, function (geometry) {
                // 頂点ごとの色（Vertex Color）を計算するロジック
                geometry.computeBoundingBox();
                const zMax = geometry.boundingBox.max.z;
                const zMin = geometry.boundingBox.min.z;
                
                const count = geometry.attributes.position.count;
                const colors = [];
                const color = new THREE.Color();

                for (let i = 0; i < count; i++) {
                    const z = geometry.attributes.position.getZ(i);
                    // 例：高さ(Z軸)に応じて青から赤へ（便宜上のデモ）
                    const ratio = (z - zMin) / (zMax - zMin);
                    color.setHSL(0.7 * (1 - ratio), 1.0, 0.5); // 0.7は青、0は赤
                    colors.push(color.r, color.g, color.b);
                }
                
                geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
                
                const material = new THREE.MeshPhongMaterial({ vertexColors: true });
                const mesh = new THREE.Mesh(geometry, material);
                scene.add(mesh);
            });
        }
    </script>
</body>
</html>
